
<!DOCTYPE html>

<html>

  <head>
    <meta charset="utf-8" />
    <title>citam.engine.core.contacts &#8212; CITAM 0.9.0 documentation</title>
<link rel="stylesheet" href="../../../../_static/style.css" type="text/css" />
<link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
<link rel="stylesheet" type="text/css" href="../../../../_static/style.css" />
<link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
<script id="documentation_options" data-url_root="../../../../"
  src="../../../../_static/documentation_options.js"></script>
<script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
<script src="../../../../_static/jquery.js"></script>
<script src="../../../../_static/underscore.js"></script>
<script src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </head>

  <body class=_modules/citam/engine/core/contacts.html><div class="container-fluid">
  <div class="row customNav fixed-top">
    <div class="col-sm-3">

      <div class="row titleBorder">
        <div class="col-sm-2 colSpacing">
          <img src="../Images/CITAM_vector.png" alt="CITAM vector" style="margin: 15px 0 0 55px" />
        </div>
      </div>

    </div>
    <div class="col-sm-9">
      <!-- Nav tabs -->
      <nav class="nav-tabs navbar navbar-expand-sm justify-content-end">
        <ul class="nav navbar-nav">
          <li class="nav-item">
            <a class="nav-link itemStyle" id="home.html"
              href="https://corning-incorporated.github.io/citam/index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link itemStyle" href="https://github.com/corning-incorporated/citam" target="_blank">View on
              GitHub</a>
          </li>
          <li class="nav-item">
            <a class="nav-link itemStyle" id="getting_started.html" href="getting_started.html">How it Works</a>
          </li>
          <li class="nav-item">
            <a class="nav-link itemStyle" id="tutorial.html" href="tutorial.html">Tutorial</a>
          </li>
          <li class="nav-item">
            <a class="nav-link itemStyle" id="index.html" href="index.html">Documentation</a>

          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<script>
  function navHighlight(elem, home, active) {
    var className = document.getElementsByTagName("body")[0].className,
      link = document.querySelectorAll(elem);
    for (var i = 0; i < link.length; i++) {
      var page = link[i].id;
      if (page == className || (page == home && className == "")) {
        link[i].className += " " + active;
      }
    }
  }
  navHighlight(
    ".customNav a",
    "home.html",
    "active"
  ); /* menu link selector, home page, highlight class */
</script>
    
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="right" style="margin-right: 10px" >
      <a href="../../../../genindex.html" title="General Index" accesskey="I">index</a>
    </li>
    <li class="right" >
      <a href="../../../../py-modindex.html" title="Python Module Index" >modules</a> |
    </li>
    <li class="nav-item nav-item-0"><a href="../../../../index.html">CITAM 0.9.0 documentation</a> &#187;</li>
    <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
    <li class="nav-item nav-item-2"><a href="../../engine.html" accesskey="U">citam.engine</a> &#187;</li> 
  </ul>
</div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for citam.engine.core.contacts</h1><div class="highlight"><pre>
<span></span><span class="c1">#  Copyright 2020. Corning Incorporated. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1">#  This software may only be used in accordance with the identified license(s).</span>
<span class="c1">#</span>
<span class="c1">#  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1">#  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1">#  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span>
<span class="c1">#  CORNING BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="c1">#  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="c1">#  CONNECTION WITH THE SOFTWARE OR THE USE OF THE SOFTWARE.</span>
<span class="c1">#  ==========================================================================</span>

<span class="kn">from</span> <span class="nn">citam.engine.core.agent</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">typing</span>


<div class="viewcode-block" id="update_data_dictionary"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.update_data_dictionary">[docs]</a><span class="k">def</span> <span class="nf">update_data_dictionary</span><span class="p">(</span>
    <span class="n">datadict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to update a dictionary to add data to existing value if</span>
<span class="sd">    the key exist or create new key:value pair if not</span>

<span class="sd">    :param dict datadict: the dictionary to update</span>
<span class="sd">    :param str key: key for the value to update</span>
<span class="sd">    :param float or int data: the value to add to current value</span>
<span class="sd">    :return: the updated dictionary</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datadict</span><span class="p">:</span>
        <span class="n">datadict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">datadict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">datadict</span></div>


<div class="viewcode-block" id="ContactEvent"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvent">[docs]</a><span class="k">class</span> <span class="nc">ContactEvent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A contact event object keeps track of the initial timestep and total</span>
<span class="sd">    duration as well as the list of xy positions, locations and floor numbers</span>
<span class="sd">    of a contact (e.g. two people walking together).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">floor_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">current_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new contact event object.</span>

<span class="sd">        :param floor_number: floor number of the contact</span>
<span class="sd">        :type floor_number: int</span>
<span class="sd">        :param location: id of the space where the contact occurred</span>
<span class="sd">        :type location: int</span>
<span class="sd">        :param position: xy position of the contact</span>
<span class="sd">        :type position: Tuple[int, int]</span>
<span class="sd">        :param current_step: the current timestep in the simulation</span>
<span class="sd">        :type current_step: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floor_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">floor_number</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_step</span> <span class="o">=</span> <span class="n">current_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="ContactEvents"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents">[docs]</a><span class="k">class</span> <span class="nc">ContactEvents</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class to keep track of every time 2 agents come in close proximity&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># TODO: maybe make this a dict subclass</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dict-like container to keep track of contact events. Each contact event</span>
<span class="sd">        is identified by a custom key made of the ids of the two agents</span>
<span class="sd">        involved.</span>

<span class="sd">        ..note:: contact events always take place between two agents.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Will keep track of the data in a dictionary instead of a matrix so</span>
        <span class="c1"># we don&#39;t waste space for agents that never come into contact with</span>
        <span class="c1"># each other. The key will be made with the unique IDs of agent 1 and</span>
        <span class="c1"># agent 2 in &quot;increasing&quot; order (i.e. the smallest always comes first)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ContactEvents.add_contact"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.add_contact">[docs]</a>    <span class="k">def</span> <span class="nf">add_contact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">agent1</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span>
        <span class="n">agent2</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span>
        <span class="n">current_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add single contact event between two agents. If there was a contact</span>
<span class="sd">        event in the previous step, update its duration and list of locations.</span>
<span class="sd">        The floor number is extracted from the first agent&#39;s position.</span>

<span class="sd">        ..note: a contact event is identified</span>

<span class="sd">        :param agent1: First agent involved in this contact event.</span>
<span class="sd">        :type agent1: Agent</span>
<span class="sd">        :param agent2: Second agent involved in this contact event.</span>
<span class="sd">        :type agent2: Agent</span>
<span class="sd">        :param current_step: Current timestep of the simulation</span>
<span class="sd">        :type current_step: int</span>
<span class="sd">        :param position: xy position of contact</span>
<span class="sd">        :type position: Tuple[int, int]</span>
<span class="sd">        :raises ValueError: If the two agents have the same ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">floor_number</span> <span class="o">=</span> <span class="n">agent1</span><span class="o">.</span><span class="n">current_floor</span>
        <span class="c1"># TODO: find location of contacts based on xy position</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">agent1</span><span class="o">.</span><span class="n">current_location</span>
        <span class="n">new_contact_event</span> <span class="o">=</span> <span class="n">ContactEvent</span><span class="p">(</span>
            <span class="n">floor_number</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">current_step</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">agent1</span><span class="o">.</span><span class="n">unique_id</span> <span class="o">==</span> <span class="n">agent2</span><span class="o">.</span><span class="n">unique_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Agents must be different.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">agent1</span><span class="o">.</span><span class="n">unique_id</span> <span class="o">&lt;</span> <span class="n">agent2</span><span class="o">.</span><span class="n">unique_id</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent1</span><span class="o">.</span><span class="n">unique_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent2</span><span class="o">.</span><span class="n">unique_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent2</span><span class="o">.</span><span class="n">unique_id</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent1</span><span class="o">.</span><span class="n">unique_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">:</span>
            <span class="n">last_contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last_contact</span><span class="o">.</span><span class="n">start_step</span> <span class="o">+</span> <span class="n">last_contact</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="n">current_step</span><span class="p">:</span>
                <span class="c1"># This is the same contact event that&#39;s continuing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">floor_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">floor_number</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is a new contact event</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_contact_event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_contact_event</span><span class="p">]</span></div>

<div class="viewcode-block" id="ContactEvents.count"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;compute the total number of unique contact events. A unique contact</span>
<span class="sd">        event involves two specific agents and has a start and end time.</span>

<span class="sd">        ..Note: two agents can have more than 1 unique contact event.</span>

<span class="sd">        :return: total number of unique contact events</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ContactEvents.save_pairwise_contacts"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.save_pairwise_contacts">[docs]</a>    <span class="k">def</span> <span class="nf">save_pairwise_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save pairwise contact data to file. The file is saved in a CSV format</span>
<span class="sd">        with the following columns: Agent1, Agent2, total contacts and total</span>
<span class="sd">        contact duration.</span>

<span class="sd">        ..note: this is an aggregate over all the contacts between two agents.</span>

<span class="sd">        :param filename: name of the file</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Agent1,Agent2,N_Contacts,TotalContactDuration</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">:</span>
                <span class="n">agent1</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">agent2</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">n_contacts</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="n">cont_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">ce</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">ce</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
                <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cont_durations</span><span class="p">))</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">agent1</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                    <span class="o">+</span> <span class="n">agent2</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                    <span class="o">+</span> <span class="n">n_contacts</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                    <span class="o">+</span> <span class="n">total_duration</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ContactEvents.extract_statistics"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.extract_statistics">[docs]</a>    <span class="nd">@typing</span><span class="o">.</span><span class="n">no_type_check</span>
    <span class="k">def</span> <span class="nf">extract_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Extract important contact statistics from contact data.</span>

<span class="sd">        :return: list of dictionaries of important statistics. Each stat is</span>
<span class="sd">                given by its name, value and unit.</span>
<span class="sd">        :rtype: list[dict[str, Dict]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statistics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># total number of people an agent has contact with</span>
        <span class="n">n_others</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># total contacts of a given agent (an agent may have multiple contacts</span>
        <span class="c1">#  with the same person)</span>
        <span class="n">total_contacts_per_agent</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># total contact duration of this agent with everyone in the facility.</span>
        <span class="c1"># This value can be really large (e.g. if someone goes to a 30-min</span>
        <span class="c1"># meeting with 10 other people, the total contact for this person is</span>
        <span class="c1"># 300 min)</span>
        <span class="n">total_contact_duration_per_agent</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">overall_total_contact_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">:</span>
            <span class="n">agent1</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">agent2</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">n_contacts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">cont_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">ce</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">ce</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="n">overall_total_contact_duration</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cont_durations</span><span class="p">)</span>

            <span class="n">total_contacts_per_agent</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span>
                <span class="n">total_contacts_per_agent</span><span class="p">,</span> <span class="n">agent1</span><span class="p">,</span> <span class="n">n_contacts</span>
            <span class="p">)</span>

            <span class="n">total_contacts_per_agent</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span>
                <span class="n">total_contacts_per_agent</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">n_contacts</span>
            <span class="p">)</span>

            <span class="n">total_contact_duration_per_agent</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span>
                <span class="n">total_contact_duration_per_agent</span><span class="p">,</span> <span class="n">agent1</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cont_durations</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">total_contact_duration_per_agent</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span>
                <span class="n">total_contact_duration_per_agent</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cont_durations</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">n_others</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span><span class="n">n_others</span><span class="p">,</span> <span class="n">agent1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;overall_total_contact_duration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">overall_total_contact_duration</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">n_agents_with_contact</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_contacts_per_agent</span><span class="p">)</span>
        <span class="n">avg_n_contacts_per_agent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">n_agents_with_contact</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">avg_n_contacts_per_agent</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">total_contacts_per_agent</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="n">n_agents_with_contact</span>
            <span class="p">)</span>
        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;avg_n_contacts_per_agent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_n_contacts_per_agent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">total_contact_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">total_contact_duration_per_agent</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">avg_contact_duration_per_agent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">n_agents_with_contact</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">avg_contact_duration_per_agent</span> <span class="o">=</span> <span class="n">total_contact_duration</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">n_agents_with_contact</span> <span class="o">*</span> <span class="mf">2.0</span>
            <span class="p">)</span>
        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;avg_contact_duration_per_agent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_contact_duration_per_agent</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;n_agents_with_contacts&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">n_agents_with_contact</span><span class="p">,</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">avg_number_of_people_per_agent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">n_agents_with_contact</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">avg_number_of_people_per_agent</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">n_others</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="n">n_agents_with_contact</span>
            <span class="p">)</span>
        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;avg_number_of_people_per_agent&quot;</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_number_of_people_per_agent</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">max_contacts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_contacts_per_agent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_contacts</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_contacts_per_agent</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">statistics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;max_contacts&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">max_contacts</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">statistics</span></div>

<div class="viewcode-block" id="ContactEvents.get_floor_contact_coords"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.get_floor_contact_coords">[docs]</a>    <span class="k">def</span> <span class="nf">get_floor_contact_coords</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">floor_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over all contact events associated with key (referring to two</span>
<span class="sd">        specific agents), and return the ones that took place on given floor</span>
<span class="sd">        number.</span>

<span class="sd">        :param key: the pair of agents given by a key of the form</span>
<span class="sd">            &lt;agent1_id&gt;-&lt;agent2_id&gt; where agent1_id &lt; agent2_id.</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param floor_number: index of the floor of interest.</span>
<span class="sd">        :type floor_number: int</span>
<span class="sd">        :return: the xy coordinates of where contacts took place</span>
<span class="sd">        :rtype: List[Tuple[int, int]]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">floor_positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ce</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ce</span><span class="o">.</span><span class="n">positions</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ce</span><span class="o">.</span><span class="n">floor_numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor_number</span><span class="p">:</span>
                    <span class="n">floor_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">floor_positions</span></div>

<div class="viewcode-block" id="ContactEvents.get_contacts_per_coordinates"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.get_contacts_per_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">get_contacts_per_coordinates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">floor_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save per coordinate contact data to file.</span>

<span class="sd">        :param step: Simulation step for which to extract contact data.</span>
<span class="sd">        :type step: int</span>
<span class="sd">        :param floor_number: Floor number for which to extract data.</span>
<span class="sd">        :type floor_number: int</span>
<span class="sd">        :return: Dictionary of contacts per location with xy positions as keys</span>
<span class="sd">        :rtype: Dict[Tuple[int, int], int]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">contacts_per_location</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="p">:</span>
            <span class="n">floor_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_floor_contact_coords</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">floor_number</span><span class="p">)</span>
            <span class="n">unique_positions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">floor_positions</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">unique_positions</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">floor_positions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

                <span class="n">contacts_per_location</span> <span class="o">=</span> <span class="n">update_data_dictionary</span><span class="p">(</span>
                    <span class="n">contacts_per_location</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">count</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">contacts_per_location</span></div>

<div class="viewcode-block" id="ContactEvents.save_raw_contact_data"><a class="viewcode-back" href="../../../../autoapi/citam/engine/core/contacts/index.html#citam.engine.core.contacts.ContactEvents.save_raw_contact_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_raw_contact_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save all contact data to file.</span>

<span class="sd">        This will write all the contact information in this simulation to file</span>
<span class="sd">        (can be big). The data will be converted to a dictionary of list of</span>
<span class="sd">        dictionaries where the top dictionary is keyed by agent_id - agent_id</span>
<span class="sd">        with their corresponding list of contacts. Each contact event is</span>
<span class="sd">        represented by a dictionary with property names and values of the</span>
<span class="sd">        ContactEvent class.</span>

<span class="sd">        :param filename: The file path to save the data</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_to_save</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">))</span></div></div>

    <span class="c1"># TODO: create function to add 2 contact_events objects</span>
</pre></div>

          </div>
        </div>
      </div>
<div class="sphinxsidebar" role="navigation" aria-label="main navigation">
  <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  </div>
</div>
      <div class="clearer"></div>
    </div>
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="right" style="margin-right: 10px" >
      <a href="../../../../genindex.html" title="General Index" >index</a>
    </li>
    <li class="right" >
      <a href="../../../../py-modindex.html" title="Python Module Index" >modules</a> |
    </li>
    <li class="nav-item nav-item-0"><a href="../../../../index.html">CITAM 0.9.0 documentation</a> &#187;</li>
    <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
    <li class="nav-item nav-item-2"><a href="../../engine.html" >citam.engine</a> &#187;</li> 
  </ul>
</div><div class="container-fluid">
  <!--    Footer Section-->
  <div class="row customNav fixed-bottom">
    <div class="col-sm-6">
      <nav class="navbar navbar-expand-sm">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#">Terms of Use</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Privacy Notice</a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="https://github.com/corning-incorporated/citam/blob/main/LICENSE"
              target="_blank"
              >Licensing</a
            >
          </li>
        </ul>
      </nav>
    </div>
    <div class="col-sm-6">
      <p id="copyRight">
        &#169; 2020 Corning Incorporated. All Rights Reserved.
      </p>
    </div>
  </div>
</div>
  </body>

  </html>